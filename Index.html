<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamsSphere</title>
    <!-- HLS.js for streaming -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <!-- YouTube IFrame API for YouTube links -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        /* --- Aurora Glass Theme --- */
        :root {
            --bg-color: #0a0a14;
            --text-color: #f0f0f5;
            --text-muted: #a0a0b0;
            --accent-color: #8A2BE2; /* A vibrant purple */
            --accent-glow: rgba(138, 43, 226, 0.5);
            --glass-bg: rgba(20, 20, 35, 0.55); 
            --border-color: rgba(138, 43, 226, 0.2);
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0d042f, #2c135c, #0a192f, #3d2f7b);
            color: var(--text-color);
            overflow: hidden;
            background-size: 400% 400%;
            animation: aurora-flow 20s ease infinite;
        }
        @keyframes aurora-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .hidden { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: var(--accent-color); border-radius: 4px; }
        .glass-ui { background: var(--glass-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border-color); }
        header, #sidebar { background: var(--glass-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border-color: var(--border-color); }
        #player-container { box-shadow: 0 0 25px var(--accent-glow), 0 0 10px rgba(0,0,0,0.5); border: 1px solid var(--border-color); }
        
        .header-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            text-shadow: 0 0 10px var(--accent-glow), 0 0 2px rgba(0,0,0,0.5);
            animation: pulse-text-glow 3s infinite ease-in-out;
        }

        @keyframes pulse-text-glow {
            0%, 100% { text-shadow: 0 0 10px var(--accent-glow), 0 0 2px rgba(0,0,0,0.5); }
            50% { text-shadow: 0 0 20px rgba(138, 43, 226, 0.8), 0 0 2px rgba(0,0,0,0.5); }
        }

        @keyframes pulse-aurora {
            0% { background-color: var(--accent-color); box-shadow: 0 0 0 0 var(--accent-glow); }
            70% { box-shadow: 0 0 0 10px rgba(138, 43, 226, 0); }
            100% { background-color: var(--accent-color); box-shadow: 0 0 0 0 rgba(138, 43, 226, 0); }
        }
        .channel-item.active { color: white; animation: pulse-aurora 2s infinite; }
        .channel-item.active .channel-title, .channel-item.active .text-slate-400 { color: white; }
        .channel-item:hover { background-color: rgba(138, 43, 226, 0.2); }
        .favorite-btn.favorite { color: var(--accent-color); }
        .custom-input { background-color: rgba(0,0,0,0.2); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 0.5rem; outline: none; transition: all 0.2s ease-in-out; }
        .custom-input:focus { border-color: var(--accent-color); box-shadow: 0 0 8px var(--accent-glow); }
        #sidebar { transition: transform 0.3s ease-in-out; }
        .loader { border: 4px solid var(--border-color); border-top: 4px solid var(--accent-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #source-selector-dropdown {
            border: 1px solid rgba(138, 43, 226, 0.5);
            box-shadow: 0 0 20px var(--accent-glow);
        }

        /* --- Football Ad Banner Styling --- */
        .football-ad-banner {
            display: block;
            position: relative;
            width: 100%;
            max-width: 700px; 
            aspect-ratio: 4 / 1;
            border-radius: 0.75rem;
            overflow: hidden;
            color: white;
            text-decoration: none;
            background-color: #000;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: pulse-border-glow 4s infinite ease-in-out;
        }
        @keyframes pulse-border-glow {
            0%, 100% { box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4), 0 0 20px var(--accent-glow); }
            50% { box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 35px rgba(138, 43, 226, 0.8); }
        }
        .football-ad-banner:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5), 0 0 30px var(--accent-glow);
        }
        .football-ad-banner .banner-bg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease-out;
        }
        .football-ad-banner:hover .banner-bg {
            transform: scale(1.1);
        }
        .football-ad-banner .banner-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to right, rgba(10, 2, 30, 0.8) 0%, rgba(0,0,0,0.1) 50%, rgba(10, 2, 30, 0.8) 100%);
            z-index: 1;
        }
        .football-ad-banner .banner-content {
            position: relative;
            z-index: 2;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            text-align: center;
        }
        .football-ad-banner .cta-text { text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
        .football-ad-banner .cta-text h2 { font-size: clamp(1.2rem, 4vw, 2rem); font-weight: 700; line-height: 1.1; }
        .football-ad-banner .cta-button {
            display: inline-block;
            margin-top: 0.75rem;
            padding: 0.5rem 1.5rem;
            background: linear-gradient(45deg, var(--accent-color), #c367fd);
            border-radius: 999px;
            font-weight: 600;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            box-shadow: 0 0 15px var(--accent-glow);
            transition: all 0.2s ease;
            animation: pulse-glow 2.5s infinite;
        }
        .football-ad-banner:hover .cta-button { transform: scale(1.05); box-shadow: 0 0 25px var(--accent-glow); }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px var(--accent-glow); }
            50% { box-shadow: 0 0 25px rgba(138, 43, 226, 0.8); }
        }
        .football-ad-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: -150%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);
            transition: left 0.6s ease-in-out;
            z-index: 3;
            transform: skewX(-25deg);
        }
        .football-ad-banner:hover::before { left: 150%; }

    </style>
</head>
<body class="bg-slate-900">
    <div class="relative h-screen w-screen flex flex-col">
        <!-- Header -->
        <header class="w-full border-b flex items-center justify-between p-2 z-20 flex-shrink-0">
            <div class="flex items-center space-x-4">
                <button id="menu-toggle" class="md:hidden p-2 text-slate-400 hover:text-purple-400 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
                <div class="flex items-center space-x-3">
                    <img id="logo" src="https://images.weserv.nl/?url=iili.io/Fg2td42.png" alt="StreamsSphere Logo" class="h-10 w-auto">
                    <span class="text-xl font-bold text-white header-title">StreamsSphere</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Sidebar -->
            <aside id="sidebar" class="absolute md:relative top-0 left-0 h-full w-64 md:w-72 border-r flex flex-col z-30 transform -translate-x-full md:translate-x-0 flex-shrink-0">
                <div class="p-4 border-b border-[var(--border-color)]">
                    <div id="custom-select-container" class="relative">
                        <button id="source-selector-button" class="w-full p-2 custom-input flex items-center justify-between text-left">
                            <span class="flex items-center space-x-2 truncate">
                                <span id="source-selector-icon"></span>
                                <span id="source-selector-text">Select a Playlist</span>
                            </span>
                            <svg class="w-4 h-4 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                        <div id="source-selector-dropdown" class="absolute hidden mt-1 w-full glass-ui rounded-md shadow-lg z-40 flex flex-col">
                            <div class="p-2 border-b border-[var(--border-color)]">
                                <input type="text" id="playlist-search-input" placeholder="Search playlists..." class="w-full p-2 custom-input text-sm">
                            </div>
                            <div id="playlist-options-container" class="max-h-60 overflow-y-auto custom-scrollbar"></div>
                        </div>
                    </div>
                </div>
                <div class="p-4 border-b border-[var(--border-color)]">
                    <input type="text" id="search-input" placeholder="Search channels..." class="w-full p-2 custom-input text-sm">
                </div>
                <div id="playlist-container" class="flex-1 overflow-y-auto custom-scrollbar">
                    <div id="playlist-element"></div>
                </div>
            </aside>

            <!-- Player Area -->
            <main class="flex-1 flex flex-col p-2 md:p-4 overflow-y-auto custom-scrollbar">
                <div id="player-container" class="relative w-full aspect-video bg-black rounded-lg flex-shrink-0">
                    <video id="main-player" class="absolute top-0 left-0 w-full h-full rounded-lg" controls playsinline></video>
                    <div id="youtube-player-container" class="absolute top-0 left-0 w-full h-full hidden rounded-lg"></div>
                    <div id="error-overlay" class="hidden absolute inset-0 bg-black bg-opacity-80 flex items-center justify-center text-center p-4 rounded-lg">
                        <p class="text-red-500 font-semibold">Could not load stream. The source may be offline or invalid.</p>
                    </div>
                </div>

                <!-- *** UPGRADED ADVERT BANNER *** -->
                <div id="premium-ad-banner-container" class="my-4 flex justify-center px-2">
                    <a href="https://www.profitableratecpm.com/qb069j7b6?key=e6b8dcd0a21df19017732330d1236fd3" target="_blank" rel="noopener noreferrer" class="football-ad-banner">
                        <img src="https://images.unsplash.com/photo-1518091040431-33b64a6a52d7?q=80&w=2070&auto=format&fit=crop" alt="Football Stadium" class="banner-bg" onerror="this.style.display='none';">
                        <div class="banner-overlay"></div>
                        <div class="banner-content">
                            <div class="cta-text">
                                <h2>Unlock Every Goal</h2>
                                <span class="cta-button">LIVE Matches Streaming Now</span>
                            </div>
                        </div>
                    </a>
                </div>

                <!-- Script-based Advertisement Block -->
                <div id="ad-container" class="my-4 flex justify-center items-center min-h-[90px]">
                    <script type="text/javascript" src="https://www.profitableratecpm.com/ei7q91h0?key=2de2b317231153ac1fa87bc23f519172"></script>
                </div>
            </main>
        </div>
    </div>

    <!-- Ad Modal -->
    <div id="ad-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="glass-ui p-4 text-center rounded-lg shadow-lg shadow-purple-500/20">
            <img id="ad-image" src="https://via.placeholder.com/300x150" alt="Ad" class="mx-auto mb-4 cursor-pointer rounded">
            <button id="close-ad-btn" class="mt-2 p-2 w-full bg-purple-600 text-white font-bold rounded hover:bg-purple-500 transition-colors">Close</button>
        </div>
    </div>

    <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

    <script>
    window.onload = function() {
        const elements = {
            mainPlayer: document.getElementById('main-player'),
            youtubePlayerContainer: document.getElementById('youtube-player-container'),
            playerContainer: document.getElementById('player-container'),
            errorOverlay: document.getElementById('error-overlay'),
            sourceSelectorButton: document.getElementById('source-selector-button'),
            sourceSelectorIcon: document.getElementById('source-selector-icon'),
            sourceSelectorText: document.getElementById('source-selector-text'),
            sourceSelectorDropdown: document.getElementById('source-selector-dropdown'),
            playlistSearchInput: document.getElementById('playlist-search-input'),
            playlistOptionsContainer: document.getElementById('playlist-options-container'),
            searchInput: document.getElementById('search-input'),
            playlistElement: document.getElementById('playlist-element'),
            adModal: document.getElementById('ad-modal'),
            adImage: document.getElementById('ad-image'),
            closeAdBtn: document.getElementById('close-ad-btn'),
            sidebar: document.getElementById('sidebar'),
            menuToggle: document.getElementById('menu-toggle'),
            mobileOverlay: document.getElementById('mobile-overlay'),
            adContainer: document.getElementById('ad-container'),
        };

        let hls, ytPlayer, allChannelsInPlaylist = [],
            groupedChannels = {},
            favorites = JSON.parse(localStorage.getItem('iptv_favorites')) || [],
            channelClickCounter = 0,
            activePlayer = null,
            urlToPlayAfterAd = null;
        let lastClickedUrl = null;

        const countryMap = { 'af': { name: 'Afghanistan', flag: 'ðŸ‡¦ðŸ‡«' }, 'al': { name: 'Albania', flag: 'ðŸ‡¦ðŸ‡±' }, 'dz': { name: 'Algeria', flag: 'ðŸ‡©ðŸ‡¿' }, 'ad': { name: 'Andorra', flag: 'ðŸ‡¦ðŸ‡©' }, 'ao': { name: 'Angola', flag: 'ðŸ‡¦ðŸ‡´' }, 'ar': { name: 'Argentina', flag: 'ðŸ‡¦ðŸ‡·' }, 'am': { name: 'Armenia', flag: 'ðŸ‡¦ðŸ‡²' }, 'aw': { name: 'Aruba', flag: 'ðŸ‡¦ðŸ‡¼' }, 'au': { name: 'Australia', flag: 'ðŸ‡¦ðŸ‡º' }, 'at': { name: 'Austria', flag: 'ðŸ‡¦ðŸ‡¹' }, 'az': { name: 'Azerbaijan', flag: 'ðŸ‡¦ðŸ‡¿' }, 'bs': { name: 'Bahamas', flag: 'ðŸ‡§ðŸ‡¸' }, 'bh': { name: 'Bahrain', flag: 'ðŸ‡§ðŸ‡­' }, 'bd': { name: 'Bangladesh', flag: 'ðŸ‡§ðŸ‡©' }, 'bb': { name: 'Barbados', flag: 'ðŸ‡§ðŸ‡§' }, 'by': { name: 'Belarus', flag: 'ðŸ‡§ðŸ‡¾' }, 'be': { name: 'Belgium', flag: 'ðŸ‡§ðŸ‡ª' }, 'bz': { name: 'Belize', flag: 'ðŸ‡§ðŸ‡¿' }, 'bj': { name: 'Benin', flag: 'ðŸ‡§ðŸ‡¯' }, 'bm': { name: 'Bermuda', flag: 'ðŸ‡§ðŸ‡²' }, 'bt': { name: 'Bhutan', flag: 'ðŸ‡§ðŸ‡¹' }, 'bo': { name: 'Bolivia', flag: 'ðŸ‡§ðŸ‡´' }, 'ba': { name: 'Bosnia and Herzegovina', flag: 'ðŸ‡§ðŸ‡¦' }, 'bw': { name: 'Botswana', flag: 'ðŸ‡§ðŸ‡¼' }, 'br': { name: 'Brazil', flag: 'ðŸ‡§ðŸ‡·' }, 'bn': { name: 'Brunei', flag: 'ðŸ‡§ðŸ‡³' }, 'bg': { name: 'Bulgaria', flag: 'ðŸ‡§ðŸ‡¬' }, 'bf': { name: 'Burkina Faso', flag: 'ðŸ‡§ðŸ‡«' }, 'bi': { name: 'Burundi', flag: 'ðŸ‡§ðŸ‡®' }, 'kh': { name: 'Cambodia', flag: 'ðŸ‡°ðŸ‡­' }, 'cm': { name: 'Cameroon', flag: 'ðŸ‡¨ðŸ‡²' }, 'ca': { name: 'Canada', flag: 'ðŸ‡¨ðŸ‡¦' }, 'cv': { name: 'Cape Verde', flag: 'ðŸ‡¨ðŸ‡»' }, 'ky': { name: 'Cayman Islands', flag: 'ðŸ‡°ðŸ‡¾' }, 'cf': { name: 'Central African Republic', flag: 'ðŸ‡¨ðŸ‡«' }, 'td': { name: 'Chad', flag: 'ðŸ‡¹ðŸ‡©' }, 'cl': { name: 'Chile', flag: 'ðŸ‡¨ðŸ‡±' }, 'cn': { name: 'China', flag: 'ðŸ‡¨ðŸ‡³' }, 'co': { name: 'Colombia', flag: 'ðŸ‡¨ðŸ‡´' }, 'km': { name: 'Comoros', flag: 'ðŸ‡°ðŸ‡²' }, 'cg': { name: 'Congo', flag: 'ðŸ‡¨ðŸ‡¬' }, 'cd': { name: 'DR Congo', flag: 'ðŸ‡¨ðŸ‡©' }, 'cr': { name: 'Costa Rica', flag: 'ðŸ‡¨ðŸ‡·' }, 'ci': { name: 'Cote d\'Ivoire', flag: 'ðŸ‡¨ðŸ‡®' }, 'hr': { name: 'Croatia', flag: 'ðŸ‡­ðŸ‡·' }, 'cu': { name: 'Cuba', flag: 'ðŸ‡¨ðŸ‡º' }, 'cy': { name: 'Cyprus', flag: 'ðŸ‡¨ðŸ‡¾' }, 'cz': { name: 'Czech Republic', flag: 'ðŸ‡¨ðŸ‡¿' }, 'dk': { name: 'Denmark', flag: 'ðŸ‡©ðŸ‡°' }, 'dj': { name: 'Djibouti', flag: 'ðŸ‡©ðŸ‡¯' }, 'dm': { name: 'Dominica', flag: 'ðŸ‡©ðŸ‡²' }, 'do': { name: 'Dominican Republic', flag: 'ðŸ‡©ðŸ‡´' }, 'ec': { name: 'Ecuador', flag: 'ðŸ‡ªðŸ‡¨' }, 'eg': { name: 'Egypt', flag: 'ðŸ‡ªðŸ‡¬' }, 'sv': { name: 'El Salvador', flag: 'ðŸ‡¸ðŸ‡»' }, 'gq': { name: 'Equatorial Guinea', flag: 'ðŸ‡¬ðŸ‡¶' }, 'ee': { name: 'Estonia', flag: 'ðŸ‡ªðŸ‡ª' }, 'et': { name: 'Ethiopia', flag: 'ðŸ‡ªðŸ‡¹' }, 'fj': { name: 'Fiji', flag: 'ðŸ‡«ðŸ‡¯' }, 'fi': { name: 'Finland', flag: 'ðŸ‡«ðŸ‡®' }, 'fr': { name: 'France', flag: 'ðŸ‡«ðŸ‡·' }, 'ga': { name: 'Gabon', flag: 'ðŸ‡¬ðŸ‡¦' }, 'gm': { name: 'Gambia', flag: 'ðŸ‡¬ðŸ‡²' }, 'ge': { name: 'Georgia', flag: 'ðŸ‡¬ðŸ‡ª' }, 'de': { name: 'Germany', flag: 'ðŸ‡©ðŸ‡ª' }, 'gh': { name: 'Ghana', flag: 'ðŸ‡¬ðŸ‡­' }, 'gi': { name: 'Gibraltar', flag: 'ðŸ‡¬ðŸ‡®' }, 'gr': { name: 'Greece', flag: 'ðŸ‡¬ðŸ‡·' }, 'gl': { name: 'Greenland', flag: 'ðŸ‡¬ðŸ‡±' }, 'gd': { name: 'Grenada', flag: 'ðŸ‡¬ðŸ‡©' }, 'gp': { name: 'Guadeloupe', flag: 'ðŸ‡¬ðŸ‡µ' }, 'gu': { name: 'Guam', flag: 'ðŸ‡¬ðŸ‡º' }, 'gt': { name: 'Guatemala', flag: 'ðŸ‡¬ðŸ‡¹' }, 'gn': { name: 'Guinea', flag: 'ðŸ‡¬ðŸ‡³' }, 'gw': { name: 'Guinea-Bissau', flag: 'ðŸ‡¬ðŸ‡¼' }, 'gy': { name: 'Guyana', flag: 'ðŸ‡¬ðŸ‡¾' }, 'ht': { name: 'Haiti', flag: 'ðŸ‡­ðŸ‡¹' }, 'hn': { name: 'Honduras', flag: 'ðŸ‡­ðŸ‡³' }, 'hk': { name: 'Hong Kong', flag: 'ðŸ‡­ðŸ‡°' }, 'hu': { name: 'Hungary', flag: 'ðŸ‡­ðŸ‡º' }, 'is': { name: 'Iceland', flag: 'ðŸ‡®ðŸ‡¸' }, 'in': { name: 'India', flag: 'ðŸ‡®ðŸ‡³' }, 'id': { name: 'Indonesia', flag: 'ðŸ‡®ðŸ‡©' }, 'ir': { name: 'Iran', flag: 'ðŸ‡®ðŸ‡·' }, 'iq': { name: 'Iraq', flag: 'ðŸ‡®ðŸ‡¶' }, 'ie': { name: 'Ireland', flag: 'ðŸ‡®ðŸ‡ª' }, 'im': { name: 'Isle of Man', flag: 'ðŸ‡®ðŸ‡²' }, 'il': { name: 'Israel', flag: 'ðŸ‡®ðŸ‡±' }, 'it': { name: 'Italy', flag: 'ðŸ‡®ðŸ‡¹' }, 'jm': { name: 'Jamaica', flag: 'ðŸ‡¯ðŸ‡²' }, 'jp': { name: 'Japan', flag: 'ðŸ‡¯ðŸ‡µ' }, 'je': { name: 'Jersey', flag: 'ðŸ‡¯ðŸ‡ª' }, 'jo': { name: 'Jordan', flag: 'ðŸ‡¯ðŸ‡´' }, 'kz': { name: 'Kazakhstan', flag: 'ðŸ‡°ðŸ‡¿' }, 'ke': { name: 'Kenya', flag: 'ðŸ‡°ðŸ‡ª' }, 'xk': { name: 'Kosovo', flag: 'ðŸ‡½ðŸ‡°' }, 'kw': { name: 'Kuwait', flag: 'ðŸ‡°ðŸ‡¼' }, 'kg': { name: 'Kyrgyzstan', flag: 'ðŸ‡°ðŸ‡¬' }, 'la': { name: 'Laos', flag: 'ðŸ‡±ðŸ‡¦' }, 'lv': { name: 'Latvia', flag: 'ðŸ‡±ðŸ‡»' }, 'lb': { name: 'Lebanon', flag: 'ðŸ‡±ðŸ‡§' }, 'ls': { name: 'Lesotho', flag: 'ðŸ‡±ðŸ‡¸' }, 'lr': { name: 'Liberia', flag: 'ðŸ‡±ðŸ‡·' }, 'ly': { name: 'Libya', flag: 'ðŸ‡±ðŸ‡¾' }, 'li': { name: 'Liechtenstein', flag: 'ðŸ‡±ðŸ‡®' }, 'lt': { name: 'Lithuania', flag: 'ðŸ‡±ðŸ‡¹' }, 'lu': { name: 'Luxembourg', flag: 'ðŸ‡±ðŸ‡º' }, 'mo': { name: 'Macau', flag: 'ðŸ‡²ðŸ‡´' }, 'mk': { name: 'North Macedonia', flag: 'ðŸ‡²ðŸ‡°' }, 'mg': { name: 'Madagascar', flag: 'ðŸ‡²ðŸ‡¬' }, 'mw': { name: 'Malawi', flag: 'ðŸ‡²ðŸ‡¼' }, 'my': { name: 'Malaysia', flag: 'ðŸ‡²ðŸ‡¾' }, 'mv': { name: 'Maldives', flag: 'ðŸ‡²ðŸ‡»' }, 'ml': { name: 'Mali', flag: 'ðŸ‡²ðŸ‡±' }, 'mt': { name: 'Malta', flag: 'ðŸ‡²ðŸ‡¹' }, 'mq': { name: 'Martinique', flag: 'ðŸ‡²ðŸ‡¶' }, 'mr': { name: 'Mauritania', flag: 'ðŸ‡²ðŸ‡·' }, 'mu': { name: 'Mauritius', flag: 'ðŸ‡²ðŸ‡º' }, 'yt': { name: 'Mayotte', flag: 'ðŸ‡¾ðŸ‡¹' }, 'mx': { name: 'Mexico', flag: 'ðŸ‡²ðŸ‡½' }, 'md': { name: 'Moldova', flag: 'ðŸ‡²ðŸ‡©' }, 'mc': { name: 'Monaco', flag: 'ðŸ‡²ðŸ‡¨' }, 'mn': { name: 'Mongolia', flag: 'ðŸ‡²ðŸ‡³' }, 'me': { name: 'Montenegro', flag: 'ðŸ‡²ðŸ‡ª' }, 'ms': { name: 'Montserrat', flag: 'ðŸ‡²ðŸ‡¸' }, 'ma': { name: 'Morocco', flag: 'ðŸ‡²ðŸ‡¦' }, 'mz': { name: 'Mozambique', flag: 'ðŸ‡²ðŸ‡¿' }, 'mm': { name: 'Myanmar', flag: 'ðŸ‡²ðŸ‡²' }, 'na': { name: 'Namibia', flag: 'ðŸ‡³ðŸ‡¦' }, 'np': { name: 'Nepal', flag: 'ðŸ‡³ðŸ‡µ' }, 'nl': { name: 'Netherlands', flag: 'ðŸ‡³ðŸ‡±' }, 'nc': { name: 'New Caledonia', flag: 'ðŸ‡³ðŸ‡¨' }, 'nz': { name: 'New Zealand', flag: 'ðŸ‡³ðŸ‡¿' }, 'ni': { name: 'Nicaragua', flag: 'ðŸ‡³ðŸ‡®' }, 'ne': { name: 'Niger', flag: 'ðŸ‡³ðŸ‡ª' }, 'ng': { name: 'Nigeria', flag: 'ðŸ‡³ðŸ‡¬' }, 'kp': { name: 'North Korea', flag: 'ðŸ‡°ðŸ‡µ' }, 'no': { name: 'Norway', flag: 'ðŸ‡³ðŸ‡´' }, 'om': { name: 'Oman', flag: 'ðŸ‡´ðŸ‡²' }, 'pk': { name: 'Pakistan', flag: 'ðŸ‡µðŸ‡°' }, 'ps': { name: 'Palestine', flag: 'ðŸ‡µðŸ‡¸' }, 'pa': { name: 'Panama', flag: 'ðŸ‡µðŸ‡¦' }, 'pg': { name: 'Papua New Guinea', flag: 'ðŸ‡µðŸ‡¬' }, 'py': { name: 'Paraguay', flag: 'ðŸ‡µðŸ‡¾' }, 'pe': { name: 'Peru', flag: 'ðŸ‡µðŸ‡ª' }, 'ph': { name: 'Philippines', flag: 'ðŸ‡µðŸ‡­' }, 'pl': { name: 'Poland', flag: 'ðŸ‡µðŸ‡±' }, 'pt': { name: 'Portugal', flag: 'ðŸ‡µðŸ‡¹' }, 'pr': { name: 'Puerto Rico', flag: 'ðŸ‡µðŸ‡·' }, 'qa': { name: 'Qatar', flag: 'ðŸ‡¶ðŸ‡¦' }, 're': { name: 'Reunion', flag: 'ðŸ‡·ðŸ‡ª' }, 'ro': { name: 'Romania', flag: 'ðŸ‡·ðŸ‡´' }, 'ru': { name: 'Russia', flag: 'ðŸ‡·ðŸ‡º' }, 'rw': { name: 'Rwanda', flag: 'ðŸ‡·ðŸ‡¼' }, 'kn': { name: 'Saint Kitts and Nevis', flag: 'ðŸ‡°ðŸ‡³' }, 'lc': { name: 'Saint Lucia', flag: 'ðŸ‡±ðŸ‡¨' }, 'vc': { name: 'Saint Vincent and the Grenadines', flag: 'ðŸ‡»ðŸ‡¨' }, 'sm': { name: 'San Marino', flag: 'ðŸ‡¸ðŸ‡²' }, 'st': { name: 'Sao Tome and Principe', flag: 'ðŸ‡¸ðŸ‡¹' }, 'sa': { name: 'Saudi Arabia', flag: 'ðŸ‡¸ðŸ‡¦' }, 'sn': { name: 'Senegal', flag: 'ðŸ‡¸ðŸ‡³' }, 'rs': { name: 'Serbia', flag: 'ðŸ‡·ðŸ‡¸' }, 'sc': { name: 'Seychelles', flag: 'ðŸ‡¸ðŸ‡¨' }, 'sl': { name: 'Sierra Leone', flag: 'ðŸ‡¸ðŸ‡±' }, 'sg': { name: 'Singapore', flag: 'ðŸ‡¸ðŸ‡¬' }, 'sk': { name: 'Slovakia', flag: 'ðŸ‡¸ðŸ‡°' }, 'si': { name: 'Slovenia', flag: 'ðŸ‡¸ðŸ‡®' }, 'so': { name: 'Somalia', flag: 'ðŸ‡¸ðŸ‡´' }, 'za': { name: 'South Africa', flag: 'ðŸ‡¿ðŸ‡¦' }, 'kr': { name: 'South Korea', flag: 'ðŸ‡°ðŸ‡·' }, 'ss': { name: 'South Sudan', flag: 'ðŸ‡¸ðŸ‡¸' }, 'es': { name: 'Spain', flag: 'ðŸ‡ªðŸ‡¸' }, 'lk': { name: 'Sri Lanka', flag: 'ðŸ‡±ðŸ‡°' }, 'sd': { name: 'Sudan', flag: 'ðŸ‡¸ðŸ‡©' }, 'sr': { name: 'Suriname', flag: 'ðŸ‡¸ðŸ‡·' }, 'se': { name: 'Sweden', flag: 'ðŸ‡¸ðŸ‡ª' }, 'ch': { name: 'Switzerland', flag: 'ðŸ‡¨ðŸ‡­' }, 'sy': { name: 'Syria', flag: 'ðŸ‡¸ðŸ‡¾' }, 'tw': { name: 'Taiwan', flag: 'ðŸ‡¹ðŸ‡¼' }, 'tz': { name: 'Tanzania', flag: 'ðŸ‡¹ðŸ‡¿' }, 'th': { name: 'Thailand', flag: 'ðŸ‡¹ðŸ‡­' }, 'tl': { name: 'Timor-Leste', flag: 'ðŸ‡¹ðŸ‡±' }, 'tg': { name: 'Togo', flag: 'ðŸ‡¹ðŸ‡¬' }, 'to': { name: 'Tonga', flag: 'ðŸ‡¹ðŸ‡´' }, 'tt': { name: 'Trinidad and Tobago', flag: 'ðŸ‡¹ðŸ‡¹' }, 'tn': { name: 'Tunisia', flag: 'ðŸ‡¹ðŸ‡³' }, 'tr': { name: 'Turkey', flag: 'ðŸ‡¹ðŸ‡·' }, 'tm': { name: 'Turkmenistan', flag: 'ðŸ‡¹ðŸ‡²' }, 'ug': { name: 'Uganda', flag: 'ðŸ‡ºðŸ‡¬' }, 'ua': { name: 'Ukraine', flag: 'ðŸ‡ºðŸ‡¦' }, 'ae': { name: 'United Arab Emirates', flag: 'ðŸ‡¦ðŸ‡ª' }, 'gb': { name: 'United Kingdom', flag: 'ðŸ‡¬ðŸ‡§' }, 'us': { name: 'United States', flag: 'ðŸ‡ºðŸ‡¸' }, 'uy': { name: 'Uruguay', flag: 'ðŸ‡ºðŸ‡¾' }, 'uz': { name: 'Uzbekistan', flag: 'ðŸ‡ºðŸ‡¿' }, 've': { name: 'Venezuela', flag: 'ðŸ‡»ðŸ‡ª' }, 'vn': { name: 'Vietnam', flag: 'ðŸ‡»ðŸ‡³' }, 'ye': { name: 'Yemen', flag: 'ðŸ‡¾ðŸ‡ª' }, 'zm': { name: 'Zambia', flag: 'ðŸ‡¿ðŸ‡²' }, 'zw': { name: 'Zimbabwe', flag: 'ðŸ‡¿ðŸ‡¼' } };
        const countryCodes = Object.keys(countryMap);
        const countryPlaylists = countryCodes.map(code => {
            const country = countryMap[code];
            // Use the old URL structure for all countries except the UK
            const url = (code === 'gb') 
                ? 'https://raw.githubusercontent.com/devsground/IPTV/master/country/T_Z/united_kingdom.m3u'
                : `https://iptv-org.github.io/iptv/countries/${code}.m3u`;
            return { name: country.name, url: url, icon: `<span class="text-xl">${country.flag}</span>` };
        });

        const PLAYLISTS = [
            { name: 'Fire TV', url: 'https://www.apsattv.com/firetv.m3u', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12c0-2.8 1.8-5 4-5 1.1 0 2.2.5 3 1.3.8-.8 1.3-1.9 1.3-3 0 2.8-1.8 5-4 5-1.1 0-2.2-.5-3-1.3-.8.8-1.3 1.9-1.3-3zM4 20v-8a4 4 0 014-4h8"></path></svg>` },
            { name: 'Freetv', url: 'https://www.apsattv.com/freetv.m3u', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect><polyline points="17 2 12 7 7 2"></polyline></svg>` },
            { name: 'Freemoviesplus', url: 'https://www.apsattv.com/freemoviesplus.m3u', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>` },
           { name: 'Klowd TV', url: 'https://www.apsattv.com/klowd.m3u', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"></path></svg>` },
            { name: 'LG', url: 'https://www.apsattv.com/lg.m3u', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 8h-2v6h2v-2h1c1.1 0 2-.9 2-2v-1c0-1.1-.9-2-2-2h-1zm3 6h-1v-2h1v2z"></path></svg>` },
            { name: 'Plex US', url: 'https://raw.githubusercontent.com/iptv-org/iptv/master/streams/us_plex.m3u', icon: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M4 4v16h5.33V4H4zm6.67 0v16h8L13.33 12 18.67 4h-8z"/></svg>` },
            { name: 'Public Domain', channels: [{ title: 'The Death Kiss (1932)', url: 'https://archive.org/download/TheDeathKiss/TheDeathKiss.mp4', logo: 'https://archive.org/download/TheDeathKiss/TheDeathKiss.thumbs/TheDeathKiss_000027.jpg' }, { title: 'Dracula (1931)', url: 'https://ia800501.us.archive.org/2/items/dracula-colorized/Dracula%201931.mp4', logo: 'https://archive.org/download/dracula-colorized/dracula-colorized.thumbs/dracula-colorized_000051.jpg' }, { title: 'House on Haunted Hill (1959)', url: 'https://youtu.be/VtwGHZk6UES' }, ], icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>`},
            { name: 'Weelly', url: 'https://www.apsattv.com/weelly.m3u', icon: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14h-2V8h2v8zm4 0h-2V8h2v8z"/></svg>`},
            { name: 'Vidaa', url: 'https://www.apsattv.com/vidaa.m3u', icon: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5L5 9l1.5-1.5L10 14.5l7.5-7.5L19 8.5l-9 9z"/></svg>` },
            { name: 'Xiaomi', url: 'https://www.apsattv.com/xiaomi.m3u', icon: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M6 15h2V9H6v6zm4-2h2V9h-2v4zm11-7H3v12h18V6zM5 16V8h14v8H5z"/></svg>` },
            { name: 'Xumo', url: 'https://www.apsattv.com/xumo.m3u', icon: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M14.59 8L12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41 14.59 8zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>`},
            { name: 'Zeasn', url: 'https://www.apsattv.com/zeasn.m3u', icon: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 7h-2v6h2V7zm4 0h-2v6h2V7z"/></svg>` },
            ...countryPlaylists
        ].sort((a, b) => a.name.localeCompare(b.name));

        const CORS_PROXIES = ['https://corsproxy.io/?', 'https://api.allorigins.win/raw?url='];
        const CACHE_EXPIRATION_MS = 24 * 60 * 60 * 1000;
        
        function initializePlayers() { if (Hls.isSupported()) { hls = new Hls({ fragLoadingMaxRetry: 4, manifestLoadingMaxRetry: 1 }); hls.attachMedia(elements.mainPlayer); hls.on(Hls.Events.ERROR, (event, data) => { if (data.fatal) { console.error('HLS Error:', data); showErrorOverlay(); } }); } elements.mainPlayer.addEventListener('error', () => { if (!hls?.url && elements.mainPlayer.getAttribute('src')) { console.error('Video Error'); showErrorOverlay(); } }); window.onYouTubeIframeAPIReady = () => { ytPlayer = new YT.Player('youtube-player-container', { width: '100%', height: '100%', playerVars: { autoplay: 1, controls: 1, playsinline: 1 }, events: { 'onError': onYouTubeError } }); }; }
        function showErrorOverlay() { elements.errorOverlay.classList.remove('hidden'); }
        function hideErrorOverlay() { elements.errorOverlay.classList.add('hidden'); }
        function onYouTubeError(event) { console.error('YouTube Error:', event.data); showErrorOverlay(); }
        function showAd() { elements.mainPlayer.pause(); if (ytPlayer?.pauseVideo) ytPlayer.pauseVideo(); elements.adModal.classList.remove('hidden'); }
        function hideAdAndOpenLink() { window.open('https://otieu.com/4/9634223', '_blank'); elements.adModal.classList.add('hidden'); if (urlToPlayAfterAd) { playStream(urlToPlayAfterAd); urlToPlayAfterAd = null; } else if (activePlayer === 'youtube' && ytPlayer?.playVideo) { ytPlayer.playVideo(); } else if (activePlayer === 'hls' && elements.mainPlayer) { elements.mainPlayer.play().catch(e => console.warn("Playback resume failed.", e)); } }
        async function fetchWithFallback(url) { for (const proxy of CORS_PROXIES) { try { const response = await fetch(proxy + encodeURIComponent(url)); if (response.ok) return await response.text(); } catch (e) { console.warn(`Proxy failed for ${url}:`, e); } } throw new Error(`All CORS proxies failed for ${url}.`); }
        async function parseM3U(data, playlistName) { const lines = data.split('\n'); const channels = []; const groups = {}; const playlistsToCategorize = ['Fire TV', 'Freetv', 'Freemoviesplus', 'Klowd TV', 'LG', 'Weelly', 'Vidaa', 'Xiaomi', 'Xumo', 'Zeasn']; for (let i = 0; i < lines.length; i++) { if (lines[i].startsWith('#EXTINF:')) { const info = lines[i]; const url = lines[i + 1]?.trim(); if (url && (url.startsWith('http') || url.startsWith('//'))) { let title = info.match(/,(.+)/)?.[1]?.trim() || 'Unknown'; const logo = info.match(/tvg-logo="([^"]+)"/)?.[1]; let group = info.match(/group-title="([^"]+)"/)?.[1]?.trim() || 'Uncategorized'; if (playlistsToCategorize.includes(playlistName)) { const countryCodeMatch = title.match(/\(([a-zA-Z]{2})\)$/); if (countryCodeMatch) { const code = countryCodeMatch[1].toLowerCase(); if (countryMap[code]) { group = `${countryMap[code].flag} ${countryMap[code].name}`; } } } const channelData = { title, logo, url, group }; channels.push(channelData); if (!groups[group]) groups[group] = []; groups[group].push(channelData); } } } return { all: channels, grouped: groups }; }
        async function loadDataForSource(sourceKey) { elements.playlistElement.innerHTML = `<div class="flex justify-center items-center h-full"><div class="loader"></div></div>`; allChannelsInPlaylist = []; groupedChannels = {}; if (sourceKey === 'Favorites') { if (favorites.length === 0) { elements.playlistElement.innerHTML = `<p class="p-4 text-center text-[var(--text-muted)]">No favorites yet.</p>`; return; } allChannelsInPlaylist = favorites; populatePlaylistUI(favorites, false); return; } const playlist = PLAYLISTS.find(p => p.name === sourceKey); if (!playlist) { elements.playlistElement.innerHTML
= `<p class="p-4 text-center text-[var(--text-muted)]">Playlist not found.</p>`; return; } if (playlist.channels) { allChannelsInPlaylist = playlist.channels; groupedChannels = { [playlist.name]: playlist.channels }; displayCategories(); return; } const cacheKey = `iptv_cache_${playlist.name}`; try { const cachedItem = localStorage.getItem(cacheKey); if (cachedItem) { const { timestamp, data } = JSON.parse(cachedItem); if (Date.now() - timestamp < CACHE_EXPIRATION_MS) { const parsedData = await parseM3U(data, playlist.name); allChannelsInPlaylist = parsedData.all; groupedChannels = parsedData.grouped; displayCategories(); return; } } const data = await fetchWithFallback(playlist.url); localStorage.setItem(cacheKey, JSON.stringify({ timestamp: Date.now(), data })); const parsedData = await parseM3U(data, playlist.name); allChannelsInPlaylist = parsedData.all; groupedChannels = parsedData.grouped; displayCategories(); } catch (error) { console.error(`Failed to load playlist ${playlist.name}:`, error); elements.playlistElement.innerHTML = `<p class="p-4 text-center text-red-500">Could not load ${playlist.name}.</p>`; } }
        const categoryIcons = { 'Movies': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>`, 'News': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>`, 'Sports': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="12" x2="12" y2="12"></line><path d="M12 12c-2-2.5-2-6.5 0-9"></path><path d="M12 12c2-2.5 2-6.5 0-9"></path><path d="M12 12c-2 2.5-2 6.5 0 9"></path><path d="M12 12c2 2.5 2 6.5 0 9"></path><path d="M2.5 7.5c3 0 4.5 1.5 6 0"></path><path d="M21.5 7.5c-3 0-4.5 1.5-6 0"></path><path d="M2.5 16.5c3 0 4.5-1.5 6 0"></path><path d="M21.5 16.5c-3 0-4.5-1.5-6 0"></path></svg>`, 'Music': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 12L12 8"></path><path d="M12 12L15 11"></path><path d="M12 12L9 11"></path></svg>`, 'All': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>`, 'Default': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>` };
        function displayCategories() { elements.playlistElement.innerHTML = ''; if (allChannelsInPlaylist.length > 0) { const allChannelsDiv = document.createElement('div'); allChannelsDiv.className = 'flex items-center space-x-3 p-3 cursor-pointer hover:bg-purple-500/20 transition-colors duration-200 border-b border-[var(--border-color)]'; allChannelsDiv.innerHTML = `${categoryIcons['All']}<span>All Channels (${allChannelsInPlaylist.length})</span>`; allChannelsDiv.addEventListener('click', () => populatePlaylistUI(allChannelsInPlaylist, true)); elements.playlistElement.appendChild(allChannelsDiv); } const sortedCategories = Object.entries(groupedChannels).sort(([a], [b]) => a.localeCompare(b)); for (const [category, channels] of sortedCategories) { const categoryDiv = document.createElement('div'); categoryDiv.className = 'flex items-center space-x-3 p-3 cursor-pointer hover:bg-purple-500/20 transition-colors duration-200 border-b border-[var(--border-color)]'; const iconKey = Object.keys(categoryIcons).find(key => category.toLowerCase().includes(key.toLowerCase())) || 'Default'; categoryDiv.innerHTML = `${categoryIcons[iconKey]}<span>${category} (${channels.length})</span>`; categoryDiv.addEventListener('click', () => populatePlaylistUI(channels, true)); elements.playlistElement.appendChild(categoryDiv); } }
        function populatePlaylistUI(channels, showBackButton = false) { elements.playlistElement.innerHTML = ''; if (showBackButton) { const backButton = document.createElement('button'); backButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg> Back`; backButton.className = 'w-full flex items-center space-x-2 p-3 text-left text-purple-400 hover:bg-purple-500/20 border-b border-[var(--border-color)]'; backButton.onclick = displayCategories; elements.playlistElement.appendChild(backButton); } const listContainer = document.createElement('div'); listContainer.className = 'flex flex-col p-1'; elements.playlistElement.appendChild(listContainer); channels.sort((a, b) => a.title.localeCompare(b.title)); channels.forEach(channel => { const channelDiv = document.createElement('div'); channelDiv.className = 'channel-item flex items-center space-x-3 p-2 cursor-pointer rounded-lg transition-all duration-200'; channelDiv.dataset.url = channel.url; const isFavorite = favorites.some(f => f.url === channel.url); channelDiv.innerHTML = ` <div class="flex-shrink-0 w-12 h-12 bg-black/20 rounded-md flex items-center justify-center overflow-hidden"> <img src="${channel.logo}" class="w-full h-full object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"> <div class="channel-logo-fallback w-full h-full hidden items-center justify-center text-xl font-bold text-slate-500">${channel.title.charAt(0)}</div> </div> <span class="channel-title flex-1 text-sm text-slate-300 truncate">${channel.title}</span> <button class="favorite-btn p-1 text-lg text-slate-600 hover:text-purple-400 transition-colors ${isFavorite ? 'favorite' : ''}" data-channel='${JSON.stringify(channel)}'>â˜…</button> `; listContainer.appendChild(channelDiv); }); }
        function loadStream(url) { channelClickCounter++; if (channelClickCounter > 0 && channelClickCounter % 7 === 0) { window.open('https://www.profitableratecpm.com/qb069j7b6?key=e6b8dcd0a21df19017732330d1236fd3', '_blank'); urlToPlayAfterAd = url; showAd(); } else { playStream(url); } }
        function playStream(url) { hideErrorOverlay(); elements.mainPlayer.classList.add('hidden'); elements.youtubePlayerContainer.classList.add('hidden'); elements.mainPlayer.pause(); elements.mainPlayer.removeAttribute('src'); elements.mainPlayer.load(); if (ytPlayer?.stopVideo) ytPlayer.stopVideo(); if (hls) hls.stopLoad(); const videoIdMatch = url.match(/(?:v=|youtu.be\/|embed\/)([a-zA-Z0-9_-]{11})/); if (videoIdMatch && ytPlayer?.loadVideoById) { activePlayer = 'youtube'; elements.youtubePlayerContainer.classList.remove('hidden'); ytPlayer.loadVideoById(videoIdMatch[1]); } else { activePlayer = 'hls'; elements.mainPlayer.classList.remove('hidden'); const finalUrl = url.includes('archive.org') ? CORS_PROXIES[0] + encodeURIComponent(url) : url; if (url.endsWith('.m3u8') && Hls.isSupported()) { hls.loadSource(finalUrl); hls.once(Hls.Events.MANIFEST_PARSED, () => elements.mainPlayer.play()); } else { elements.mainPlayer.src = finalUrl; elements.mainPlayer.play(); } } localStorage.setItem('iptv_last_played', url); }
        function toggleFavorite(button) { const channelData = JSON.parse(button.dataset.channel); const index = favorites.findIndex(f => f.url === channelData.url); if (index !== -1) { favorites.splice(index, 1); button.classList.remove('favorite'); } else { favorites.push(channelData); button.classList.add('favorite'); } localStorage.setItem('iptv_favorites', JSON.stringify(favorites)); if (elements.sourceSelectorButton.textContent.trim().includes('Favorites')) { loadDataForSource('Favorites'); } }
        function enterFullscreen() { let playerElement; if (activePlayer === 'youtube') { playerElement = elements.youtubePlayerContainer.querySelector('iframe'); } else { playerElement = elements.mainPlayer; } if (playerElement) { if (playerElement.requestFullscreen) playerElement.requestFullscreen(); else if (playerElement.mozRequestFullScreen) playerElement.mozRequestFullScreen(); else if (playerElement.webkitRequestFullscreen) playerElement.webkitRequestFullscreen(); else if (playerElement.msRequestFullscreen) playerElement.msRequestFullscreen(); } }
        function updateSourceSelectorButton(playlist) { elements.sourceSelectorIcon.innerHTML = playlist.icon || 'â˜…'; elements.sourceSelectorText.textContent = playlist.name; }; const favoritesPlaylist = { name: 'Favorites', icon: 'â˜…' }; const allPlaylists = [favoritesPlaylist, ...PLAYLISTS];
        function
renderPlaylistOptions(playlistsToRender) { elements.playlistOptionsContainer.innerHTML = ''; playlistsToRender.forEach(playlist => { const optionDiv = document.createElement('div'); optionDiv.className = 'flex items-center space-x-2 p-2 cursor-pointer hover:bg-purple-500/20'; optionDiv.innerHTML = ` <span class="flex-shrink-0 w-6 text-center">${playlist.icon || 'â˜…'}</span> <span class="truncate">${playlist.name}</span>`; optionDiv.addEventListener('click', () => { localStorage.setItem('iptv_last_source', playlist.name); updateSourceSelectorButton(playlist); loadDataForSource(playlist.name); elements.sourceSelectorDropdown.classList.add('hidden'); }); elements.playlistOptionsContainer.appendChild(optionDiv); }); }
        function initialize() { initializePlayers(); renderPlaylistOptions(allPlaylists); elements.sourceSelectorButton.addEventListener('click', () => { elements.sourceSelectorDropdown.classList.toggle('hidden'); }); document.addEventListener('click', (e) => { if (!elements.sourceSelectorButton.contains(e.target) && !elements.sourceSelectorDropdown.contains(e.target)) { elements.sourceSelectorDropdown.classList.add('hidden'); } }); elements.playlistSearchInput.addEventListener('click', (e) => e.stopPropagation()); elements.playlistSearchInput.addEventListener('input', e => { const searchTerm = e.target.value.toLowerCase().trim(); const filtered = allPlaylists.filter(p => p.name.toLowerCase().includes(searchTerm)); renderPlaylistOptions(filtered); }); elements.searchInput.addEventListener('input', e => { const searchTerm = e.target.value.toLowerCase().trim(); if (!searchTerm) { displayCategories(); return; } const filteredChannels = allChannelsInPlaylist.filter(c => c.title.toLowerCase().includes(searchTerm)); populatePlaylistUI(filteredChannels, true); }); elements.closeAdBtn.addEventListener('click', hideAdAndOpenLink); elements.adImage.addEventListener('click', hideAdAndOpenLink); elements.playlistElement.addEventListener('click', handlePlaylistClick); elements.menuToggle.addEventListener('click', () => { elements.sidebar.classList.toggle('-translate-x-full'); elements.mobileOverlay.classList.toggle('hidden'); }); elements.mobileOverlay.addEventListener('click', () => { elements.sidebar.classList.add('-translate-x-full'); elements.mobileOverlay.classList.add('hidden'); }); const lastSourceName = localStorage.getItem('iptv_last_source') || PLAYLISTS[0]?.name || 'Favorites'; const lastSourcePlaylist = allPlaylists.find(p => p.name === lastSourceName) || favoritesPlaylist; updateSourceSelectorButton(lastSourcePlaylist); loadDataForSource(lastSourceName); if (!sessionStorage.getItem('adShownThisSession')) { const lastPlayed = localStorage.getItem('iptv_last_played'); if (lastPlayed) { urlToPlayAfterAd = lastPlayed; } showAd(); sessionStorage.setItem('adShownThisSession', 'true'); } }
        function handlePlaylistClick(event) { const favoriteBtn = event.target.closest('.favorite-btn'); if (favoriteBtn) { event.stopPropagation(); toggleFavorite(favoriteBtn); return; } const channelItem = event.target.closest('.channel-item'); if (channelItem) { const currentUrl = channelItem.dataset.url; if (currentUrl === lastClickedUrl) { enterFullscreen(); if (window.innerWidth < 768) { elements.sidebar.classList.add('-translate-x-full'); elements.mobileOverlay.classList.add('hidden'); } lastClickedUrl = null; } else { document.querySelectorAll('.channel-item').forEach(item => item.classList.remove('active')); channelItem.classList.add('active'); loadStream(currentUrl); lastClickedUrl = currentUrl; } } }
        window.addEventListener('resize', () => { if (ytPlayer && !elements.youtubePlayerContainer.classList.contains('hidden')) { ytPlayer.setSize('100%', '100%'); } });
        initialize();
    };
    </script>
</body>
</html>
